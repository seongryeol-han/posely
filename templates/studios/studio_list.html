{% extends "base.html" %}

{%block page_title%}

    반려동물 사진관 예약하기

{%endblock page_title%}


{% block content %} 
    
<div class="mx-auto flex flex-col items-center overflow-auto mobile:mb-10">
    
    {% for studio in studios %}
        {%include "mixins/studio/studio_card.html" with studio=studio check_exist=check_exist%}
    {% endfor %}
    
</div>


<!-- ajax jqeury 통신 -->
<script type="text/javascript">
    var like_press = function () { // .like 버튼을 클릭 감지
            var pk = $(this).attr('name')
            $.ajax({ // ajax로 서버와 통신
                type: "POST", // 데이터를 전송하는 방법
                url: "{% url 'studios:studio_like' %}", // 통신할 url을 지정
                data: { 'pk': pk, 'csrfmiddlewaretoken': '{{ csrf_token }}' }, // 서버로 데이터 전송시 옵션, pk를 넘겨야 어떤 studio인지 알 수 있음
                dataType: "json",
                success: function (response) { // 성공
                    alert(response.message); //이 부분을 지우면 메세지 안뜹니다. 
                    $("#count-" + pk).html("좋아요&nbsp;" + response.likes_count + "개"); // 좋아요 개수 변경
                    if (response.message == "좋아요")         
                    {
                        $("#check-" + pk).attr("class", "fas fa-heart fa-3x")
                    } 
                    else if (response.message == "좋아요 취소")
                    {
                       $("#check-" + pk).attr("class", "far fa-heart fa-3x")
                    }
                },
                error: function (request, status, error) { //로그인 x 경우 
                    alert("로그인이 필요합니다.")
                    window.location.href = "/users/login" // 로그인 페이지로 넘어가기
                },
            });
        }
    $(".like").click(like_press)
    $(".img_like").dblclick(like_press)
</script>



{% endblock content %}
    