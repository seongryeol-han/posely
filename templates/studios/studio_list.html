{% extends "base.html" %}

{%block page_title%}

    반려동물 사진관 예약하기

{%endblock page_title%}


{% block content %} 
    
<div class="mx-auto flex flex-col items-center overflow-auto mobile:mb-10">
    
    {% for studio in studios %}
        {%include "mixins/studio/studio_card.html" with studio=studio %}
        
        <!--좋아요 버튼 부 -->
        <div>
            <button  style="border: none; background-color:white; cursor: pointer;" class="like" name="{{ studio.pk }}" value="Like"
                style="margin-top: 7px">
                <!--내가 좋아요 누른 이미지에 대하여 로그인하자마자  하트 체크 -->
                <!--check_exist 는 studios\\view.py\\main_list 에서 전달 받음  -->  
                      
                {% if studio.pk in check_exist%}
                    <i id="check-{{studio.pk}}" class="fas fa-heart fa-3x "></i>
                {% else %}
                    <i id="check-{{studio.pk}}" class="far fa-heart fa-3x "></i>
                {% endif %}
            </button>
            <p id="count-{{ studio.pk }}" style="font:bold 1em; margin-top: 3px">
                좋아요&nbsp;{{ studio.likes_user.all.count }}개
            </p>
        </div> 
        <div class="overflow-auto mt-0.5 mx-4 mb-6 small:mb-0">
        {% comment %} <p class="font-extrabold mb-2 text-sm">좋아요 365개</p> {% endcomment %}
        <div class="font-semibold text-sm mb-1" style="color:#1a202c;" >{{studio}}</div>
        <div class=" text-sm" style="color:#1a202c;" >{{studio.introduction | linebreaksbr}}</div>
    </div>
    {% endfor %}
    
</div>

<!-- ajava jqeurt 통신 -->
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script type="text/javascript">
        $(".like").click(function () { // .like 버튼을 클릭 감지
            var pk = $(this).attr('name')
            $.ajax({ // ajax로 서버와 통신
                type: "POST", // 데이터를 전송하는 방법
                url: "{% url 'studios:studio_like' %}", // 통신할 url을 지정
                data: { 'pk': pk, 'csrfmiddlewaretoken': '{{ csrf_token }}' }, // 서버로 데이터 전송시 옵션, pk를 넘겨야 어떤 studio인지 알 수 있음
                dataType: "json",
                success: function (response) { // 성공
                    alert(response.message); //이 부분을 지우면 메세지 안뜹니다. 
                    $("#count-" + pk).html("좋아요&nbsp;" + response.likes_count + "개"); // 좋아요 개수 변경
                    if (response.message == "좋아요")         
                    {
                        $("#check-" + pk).attr("class", "fas fa-heart fa-3x")
                        
                        {% comment %} $('#pk').attr("class", "fas fa-heart fa-3x") {% endcomment %}
                    } 
                    else if (response.message == "좋아요 취소")
                    {
                       $("#check-" + pk).attr("class", "far fa-heart fa-3x")
                    }
                },
                error: function (request, status, error) { //로그인 x 경우 
                    alert("로그인이 필요합니다.")
                    window.location.href = "/users/login" // 로그인 페이지로 넘어가기
                },
            });
        })
</script>



{% endblock content %}
    